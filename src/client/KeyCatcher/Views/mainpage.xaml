<ContentPage
    x:Class="KeyCatcher.Views.Mainpage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:KeyCatcher.converters"
    xmlns:views="clr-namespace:KeyCatcher.Views"
    xmlns:vm="clr-namespace:KeyCatcher.ViewModels"
    Title="KeyCatcher"
    x:DataType="vm:MainPageViewModel"
    BackgroundColor="{StaticResource KcBg}">
    <ContentPage.Resources>
        <ResourceDictionary>
            <local:BoolToColorConverter
                x:Key="BoolToColor"
                FalseColor="#EA4335"
                TrueColor="LimeGreen" />

            <local:BothDownToBoolConverter x:Key="BothDownToBool" />
            <local:StringEqualsToBoolConverter x:Key="StringEqualsToBool" />

        </ResourceDictionary>
    </ContentPage.Resources>


    <Shell.TitleView>
        <!--<views:header
            x:Name="headerRoot"
            Title="KeyCatcher"
            BleCommand="{Binding OnBleIconClickedCommand}"
            HelpCommand="{Binding OnHelpClickedCommand}"
            IsBleUp="{Binding Hub.IsBleUp}"
            IsWifiUp="{Binding WifiUp}"
            ShowHelp="{Binding ShowHelp, Source={x:Reference headerRoot}}"
            WifiCommand="{Binding showNetworkCommand}" />-->

        <Grid
            Padding="12,0"
            BackgroundColor="#22243a"
            ColumnDefinitions="Auto,*,Auto,Auto,Auto"
            HeightRequest="44"
            VerticalOptions="Center">
            <!--  Placeholder for symmetry (could be a menu/back button in future)  -->
            <BoxView WidthRequest="1" />

            <!--  Title  -->
            <Label
                Grid.Column="1"
                FontAttributes="Bold"
                FontSize="32"
                Text="KeyCatcher"
                TextColor="SteelBlue"
                VerticalTextAlignment="Center" />

            <!--Text="{Binding IsWifiUp, StringFormat='Wi-Fi: {0:Up;Down}'}"  "{Binding Title, Source={x:Reference headerRoot}}"BLE Icon Button  -->
            <ImageButton
                Grid.Column="2"
                BackgroundColor="Transparent"
                Command="{Binding BleCommand}"
                HeightRequest="24"
                WidthRequest="24">
                <ImageButton.Source>
                    <FontImageSource
                        FontFamily="FontAwesomeBrands"
                        Glyph="{StaticResource BrandBluetooth}"
                        Color="{Binding BleIconColor}" />

                </ImageButton.Source>
            </ImageButton>
            <!--<ImageButton
        Grid.Column="2"
        BackgroundColor="Transparent"
        Command="{Binding BleCommand, Source={x:Reference headerRoot}}"
        HeightRequest="24"
        WidthRequest="24">
        <ImageButton.Source>
            <FontImageSource
                FontFamily="FontAwesomeBrands"
                Glyph="{StaticResource BrandBluetooth}"
                Color="{Binding BleIconColor}" />

        </ImageButton.Source>
    </ImageButton>-->

            <!--  Wi-Fi Icon Button  -->
            <ImageButton
                Grid.Column="3"
                Margin="6,0,0,0"
                BackgroundColor="Transparent"
                Command="{Binding showNetworkCommand}"
                HeightRequest="14"
                WidthRequest="15">
                <ImageButton.Source>
                    <FontImageSource
                        FontFamily="FontAwesomeSolid"
                        Glyph="{StaticResource SolidWifi}"
                        Color="{Binding WifiIconColor}" />
                </ImageButton.Source>
            </ImageButton>

            <!--  Help/Question Icon  Color="{Binding WifiIconColor, Source={x:Reference headerRoot}}" /> (only visible if both are down)  -->
            <ImageButton
                Grid.Column="4"
                BackgroundColor="Transparent"
                Command="{Binding HelpCommand}"
                HeightRequest="24"
                IsVisible="True"
                WidthRequest="24">
                <ImageButton.Source>
                    <FontImageSource
                        FontFamily="FontAwesomeSolid"
                        Glyph="{StaticResource SolidCircleQuestion}"
                        Color="Orange" />
                </ImageButton.Source>
            </ImageButton>
        </Grid>





    </Shell.TitleView>




    <Border
        Margin="16"
        Padding="0"
        BackgroundColor="#2C2C3E"
        StrokeShape="RoundRectangle 20"
        StrokeThickness="2">
        <Border.Shadow>
            <Shadow
                Brush="#80000000"
                Radius="12"
                Offset="0,6" />
        </Border.Shadow>

        <!--  3-row grid: Header / Editor area (star) / Footer  -->
        <Grid x:Name="CardGrid" RowDefinitions="Auto,*,Auto">

            <!--  Header  -->
            <Grid
                Grid.Row="0"
                Padding="12,8"
                Background="#3B0CA3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <!--<Label Text="Send Keys"/>-->
                <!--  Hub.IsWifiUp, StringFormat='Wi-Fi: {0:Up;Down}'}" />  -->
                <Label
                    Grid.Column="0"
                    FontAttributes="Bold"
                    FontSize="20"
                    HorizontalOptions="Start"
                    Text="Send Keys"
                    TextColor="White"
                    VerticalOptions="Center" />

                <!--<Button
                    Grid.Column="1"
                    Command="{Binding ShowSsidsCommand}"
                    Style="{StaticResource SlimButton}"
                    Text="SSIDs" />-->

                <!--<ImageButton
                    Grid.Column="1"
                    BackgroundColor="Transparent"
                    Command="{Binding NavigateSettingsCommand}"
                    Source="set100.png"
                    WidthRequest="32" />-->
            </Grid>

            <!--  Editor area (scrolls, consumes available vertical space)  -->
            <Grid Grid.Row="1" Padding="12">
                <ScrollView
                    x:Name="EditorScroll"
                    HorizontalScrollBarVisibility="Never"
                    VerticalOptions="FillAndExpand"
                    VerticalScrollBarVisibility="Always">
                    <Editor
                        x:Name="MessageEditor"
                        AutoSize="TextChanges"
                        Keyboard="Text"
                        MaxLength="8000"
                        MinimumHeightRequest="180"
                        Placeholder="- Enter any text you want typed -"
                        Text="{Binding MessageText}"
                        TextColor="White">
                        <Editor.Background>
                            <LinearGradientBrush EndPoint="0,1">
                                <GradientStop Offset="0.0" Color="#3A3A5C" />
                                <GradientStop Offset="1.0" Color="#2C2C3E" />
                            </LinearGradientBrush>
                        </Editor.Background>
                    </Editor>
                </ScrollView>
            </Grid>

            <!--  Footer (stays visible)  -->
            <HorizontalStackLayout
                Grid.Row="2"
                Padding="12,8"
                BackgroundColor="#2C2C3E"
                HorizontalOptions="End"
                Spacing="8">
                <Button
                    Padding="12,4"
                    BackgroundColor="#3B0CA3"
                    Command="{Binding ClearCommand}"
                    CornerRadius="18"
                    Text="Clear"
                    TextColor="White" />
                <Button
                    Padding="12,4"
                    BackgroundColor="#3B0CA3"
                    Clicked="OnPasteClicked"
                    CornerRadius="18"
                    Text="Paste"
                    TextColor="White" />

                <!--<Button
             Padding="12,4"
             BackgroundColor="#3B0CA3"
             Clicked="{Binding OnPasteClicked}"
             CornerRadius="18"
             Text="Paste"
             TextColor="White" />-->
                <!--<Button Command="{Binding ToggleWifiCommand}" Text="Toggle ble Status" />-->

                <Button
                    Padding="12,4"
                    BackgroundColor="#3B0CA3"
                    Command="{Binding SendCommand}"
                    CornerRadius="18"
                    Text="Send"
                    TextColor="White" />


                <Picker
                    ItemsSource="{Binding PauseOptions}"
                    SelectedItem="{Binding PauseSeconds}"
                    WidthRequest="80" />
            </HorizontalStackLayout>

        </Grid>
    </Border>

    <!--<VerticalStackLayout Padding="20">

        <Label Text="Is  wifi up"
    VerticalOptions="Center"
    HorizontalOptions="CenterAndExpand" />

        <Label Text="{Binding Hub.IsWifiUp, StringFormat='Wi-Fi: {0:Up;Down}'}"
        VerticalOptions="Center"
            HorizontalOptions="CenterAndExpand" />


        <Button Command="{Binding SendCommand}" Text="Send Message" />
        <Button Command="{Binding ShowCountdownCommand}" Text="Pause" />
    </VerticalStackLayout>-->
</ContentPage>