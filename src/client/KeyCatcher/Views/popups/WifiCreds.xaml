<toolkit:Popup
    x:Class="KeyCatcher.Popups.WifiCreds"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:KeyCatcher.converters"
    xmlns:models="clr-namespace:KeyCatcher.models"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Name="RootPopup"
    Margin="0"
    Padding="0"
    BackgroundColor="#F3E6CC">



    <toolkit:Popup.Resources>
        <ResourceDictionary>
            <local:LessThanConverter x:Key="LessThanConverter" />
            <!--<Style TargetType="Button">
            <Setter Property="Visual" Value="Default" />
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#e5e7eb, Dark=#374151}" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light=#111827, Dark=#f3f4f6}" />
            <Setter Property="Padding" Value="10,8" />
            <Setter Property="CornerRadius" Value="8" />
            </Style>-->
            <Style TargetType="Entry">
                <Setter Property="Visual" Value="Default" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#ffffff, Dark=#1f2937}" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#111827, Dark=#f9fafb}" />
                <Setter Property="FontSize" Value="{OnIdiom Phone=16, Desktop=16}" />
                <Setter Property="HeightRequest" Value="44" />
            </Style>


            <Style TargetType="Label">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#111827, Dark=#f3f4f6}" />
                <Setter Property="FontSize" Value="{OnIdiom Phone=16, Desktop=18}" />
            </Style>

            <Style TargetType="Button">
                <Setter Property="FontSize" Value="{OnIdiom Phone=16, Desktop=16}" />
                <Setter Property="HeightRequest" Value="44" />
            </Style>

            <ResourceDictionary xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml">
                <x:String x:Key="SolidPencil">&#x270f;</x:String>
                <x:String x:Key="BrandBluetooth">&#xf293;</x:String>
                <x:String x:Key="BrandBluetoothB">&#xf294;</x:String>
                <x:String x:Key="SolidWifi">&#xf1eb;</x:String>
                <x:String x:Key="SolidDeleteLeft">&#x232b;</x:String>
                <x:String x:Key="RegularPaste">&#xf0ea;</x:String>
                <x:String x:Key="RegularFile">&#xf016;</x:String>
                <x:String x:Key="SolidPlus">&#x2b;</x:String>
                <x:String x:Key="SolidTrash">&#xf1f8;</x:String>

            </ResourceDictionary>

        </ResourceDictionary>
    </toolkit:Popup.Resources>
    <!-- inside <toolkit:Popup> ... -->


    <Border
        StrokeShape="RoundRectangle 20"
        BackgroundColor="#F3E6CC"
        StrokeThickness="0"
        HorizontalOptions="Center"
        VerticalOptions="Center">
        <Grid Padding="0,0,0,0" ColumnDefinitions="*,Auto,Auto">
            <Grid.RowDefinitions>
                <RowDefinition Height="570" />
                <RowDefinition Height="*" />

            </Grid.RowDefinitions>



            <Grid RowDefinitions="*,Auto">

                <!--  ONE scroller: CollectionView owns it  -->
                <CollectionView
                Grid.Row="0"
                ItemSizingStrategy="MeasureAllItems"
                ItemsSource="{Binding Networks}"
                SelectionMode="None">

                    <!--  Everything above the list goes in Header  -->
                    <CollectionView.Header>
                        <VerticalStackLayout Padding="0" Spacing="12">
                            <Border
                            Grid.Row="0"
                            Padding="16,8"
                            Background="#2B0B98"
                            HorizontalOptions="Start"
                            StrokeShape="RoundRectangle 40,0,0,40"
                            StrokeThickness="6"
                            VerticalOptions="Start">

                                <Border.Stroke>
                                    <LinearGradientBrush EndPoint="0,1">
                                        <GradientStop Offset="0.1" Color="#CC3d4930" />
                                        <GradientStop Offset="1.0" Color="#30a6c0" />
                                    </LinearGradientBrush>
                                </Border.Stroke>
                                <Label
                                FontAttributes="Bold"
                                FontSize="20"
                                Text="Network Settings"
                                TextColor="White" />
                            </Border>

                            <!--  Title  -->


                            <!--  Primary  -->
                            <Grid
                            ColumnDefinitions="Auto,*"
                            ColumnSpacing="0"
                            RowDefinitions="Auto,Auto"
                            RowSpacing="8">
                                <Label
                                Grid.Row="0"
                                Grid.Column="0"
                                Padding="10"
                                Background="SteelBlue"
                                Text="Primary SSID"
                                TextColor="Black"
                                VerticalTextAlignment="Center" />
                                <Entry
                                Grid.Row="0"
                                Grid.Column="1"
                                ClearButtonVisibility="WhileEditing"
                                Placeholder="Your WiFi"
                                Text="{Binding PrimarySSID}"
                                TextColor="White" />
                                <Label
                                Grid.Row="1"
                                Grid.Column="0"
                                Padding="10"
                                Background="SteelBlue"
                                Text="Primary Password  "
                                TextColor="Black"
                                VerticalTextAlignment="Center" />
                                <Entry
                                Grid.Row="1"
                                Grid.Column="1"
                                ClearButtonVisibility="WhileEditing"
                                IsPassword="True"
                                Placeholder="password"
                                Text="{Binding PrimaryPassword}" />
                            </Grid>

                            <!--  Backups header + Add  -->
                            <FlexLayout
                            Margin="0,4,0,10"
                            AlignItems="Center"
                            Direction="Row"
                            JustifyContent="SpaceBetween">
                                <Label
                                FlexLayout.Basis="0%"
                                FlexLayout.Grow="1"
                                FlexLayout.Shrink="1"
                                FontAttributes="Bold"
                                LineBreakMode="TailTruncation"
                                MaxLines="1"
                                Text="Other networks(up to 4)"
                                TextColor="Black" />
                                <Button
                                Grid.Column="1"
                                Margin="8,0"
                                Padding="12,4"
                                BackgroundColor="#3B0CA3"
                                Command="{Binding AddNetworkCommand}"
                                CornerRadius="18"
                                IsEnabled="{Binding Networks.Count, Converter={StaticResource LessThanConverter}, ConverterParameter=4}"
                                Style="{StaticResource FooterButtonStyle}"
                                Text="Add"
                                TextColor="White" />
                                <!--<Button
                                BackgroundColor="SteelBlue"
                                Command="{Binding AddNetworkCommand}"
                                IsEnabled="{Binding Networks.Count, Converter={StaticResource LessThanConverter}, ConverterParameter=4}"
                                Text="Add" />-->
                            </FlexLayout>
                        </VerticalStackLayout>
                    </CollectionView.Header>

                    <!--  Item template: text in star column, icons on the right  -->
                    <CollectionView.ItemTemplate>
                        <!--  turn OFF compiled bindings in the template  -->
                        <DataTemplate x:DataType="{x:Null}">
                            <Grid
                            Padding="0"
                            ColumnDefinitions="*,Auto,Auto,Auto"
                            ColumnSpacing="8">
                                <!--  SSID text  -->
                                <Label
                                Grid.Column="0"
                                Margin="20,6"
                                Padding="10"
                                LineBreakMode="TailTruncation"
                                Text="{Binding SSID}"
                                TextColor="Black"
                                VerticalTextAlignment="Center" />

                                <!--  Make Primary  -->
                                <ContentView
                                Grid.Column="1"
                                Padding="6"
                                HeightRequest="36"
                                WidthRequest="36">
                                    <Image Source="wifi.png" />
                                    <ContentView.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={x:Reference RootPopup}, Path=BindingContext.MakePrimaryCommand}" CommandParameter="{Binding}" />
                                    </ContentView.GestureRecognizers>
                                </ContentView>

                                <!--  Edit  -->
                                <ContentView
                                Grid.Column="2"
                                Padding="6"
                                HeightRequest="30"
                                WidthRequest="30">
                                    <Image>
                                        <Image.Source>
                                            <FontImageSource
                                            FontFamily="FontAwesomeSolid"
                                            Glyph="{StaticResource SolidPencil}"
                                            Size="20"
                                            Color="Green" />
                                        </Image.Source>
                                    </Image>
                                    <ContentView.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={x:Reference RootPopup}, Path=BindingContext.EditNetworkCommand}" CommandParameter="{Binding}" />
                                    </ContentView.GestureRecognizers>
                                </ContentView>

                                <!--  Delete  -->
                                <ContentView
                                Grid.Column="3"
                                Padding="6"
                                HeightRequest="30"
                                WidthRequest="30">
                                    <Image>
                                        <Image.Source>
                                            <FontImageSource
                                            FontFamily="FontAwesomeSolid"
                                            Glyph="{StaticResource SolidTrash}"
                                            Size="20"
                                            Color="Green" />
                                        </Image.Source>
                                    </Image>
                                    <ContentView.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={x:Reference RootPopup}, Path=BindingContext.RemoveNetworkCommand}" CommandParameter="{Binding}" />
                                    </ContentView.GestureRecognizers>
                                </ContentView>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>

                    <!--  Friendly empty state  -->
                    <!--<CollectionView.EmptyView>
                    <VerticalStackLayout Padding="8" Spacing="6">
                        <Label Text="No backups yet." TextColor="Black" />
                        <Button
                            BackgroundColor="SteelBlue"
                            Command="{Binding AddNetworkCommand}"
                            Text="Add a backup network"
                            TextColor="Black" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>-->
                </CollectionView>



                <Grid
                Grid.Row="1"
                Padding="8,6"
                BackgroundColor="{AppThemeBinding Light=#ffffff,
                                                  Dark=#111827}"
                ColumnDefinitions="*,Auto,Auto">
                    <Label Text="{Binding Networks.Count, StringFormat='Secondary: {0}/4'}" VerticalTextAlignment="Center" />
                    <!--<Button
                    x:Name="BtnClose"
                    Grid.Column="1"
                    Margin="8,0"
                    Clicked="BtnClose_Clicked"
                    Text="Close" />-->


                    <Button
                    Grid.Column="1"
                    Margin="8,0"
                    Padding="12,4"
                    BackgroundColor="#3B0CA3"
                    Clicked="BtnClose_Clicked"
                    CornerRadius="18"
                    Style="{StaticResource FooterButtonStyle}"
                    Text="Close"
                    TextColor="White" />




                    <Button
                    Grid.Column="2"
                    Padding="12,4"
                    BackgroundColor="#3B0CA3"
                    Command="{Binding SaveAndCloseCommand}"
                    CornerRadius="18"
                    Text="Save n' Close"
                    TextColor="White" />


                </Grid>

                <!--</Border>-->
                <!--  Overlay editor stays as top layer; spans both rows  -->

                <Grid
                Grid.RowSpan="2"
                BackgroundColor="#80000000"
                InputTransparent="False"
                IsVisible="{Binding IsEditing}"
                ZIndex="10">

                    <!--  use the sticky editor overlay we already built  -->

                    <Border
                    x:Name="EditorCard"
                    Margin="12"
                    Padding="16"
                    BackgroundColor="{AppThemeBinding Light=#ffffff,
                                                      Dark=#1f2937}"
                    HorizontalOptions="Fill"
                    MaximumHeightRequest="300"
                    Stroke="{AppThemeBinding Light=#e5e7eb,
                                             Dark=#374151}"
                    StrokeShape="RoundRectangle 28,28,28,28"
                    StrokeThickness="1"
                    VerticalOptions="Center">
                        <Grid RowDefinitions="*,Auto" RowSpacing="12">
                            <ScrollView Grid.Row="0">
                                <Grid ColumnSpacing="5" RowSpacing="10">
                                    <Grid.ColumnDefinitions>
                                        <!--  Fixed width for label, rest for Entry  -->
                                        <ColumnDefinition Width="95" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <!--<Label
                                    Grid.ColumnSpan="2"
                                    FontAttributes="Bold"
                                    FontSize="20"
                                    Text="Edit Network" />-->
                                    <Border
                                    Grid.Row="0"
                                    Grid.ColumnSpan="2"
                                    Padding="16,5"
                                    Background="#2B0B98"
                                    HorizontalOptions="Start"
                                    StrokeShape="RoundRectangle 40,0,0,40"
                                    StrokeThickness="6"
                                    VerticalOptions="Start">

                                        <Border.Stroke>
                                            <LinearGradientBrush EndPoint="0,1">
                                                <GradientStop Offset="0.1" Color="#CC3d4930" />
                                                <GradientStop Offset="1.0" Color="#30a6c0" />
                                            </LinearGradientBrush>
                                        </Border.Stroke>
                                        <Label
                                        FontAttributes="Bold"
                                        FontSize="20"
                                        Text="Edit Network"
                                        TextColor="White" />
                                    </Border>

                                    <Label
                                    Grid.Row="1"
                                    Padding="5"
                                    Background="SteelBlue"
                                    HorizontalOptions="Start"
                                    HorizontalTextAlignment="Start"
                                    Text="SSID"
                                    TextColor="Black"
                                    VerticalTextAlignment="Center"
                                    WidthRequest="95" />
                                    <Entry
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Placeholder="SSID"
                                    Text="{Binding EditingNetwork.SSID}" />
                                    <Label
                                    Grid.Row="2"
                                    Padding="5"
                                    Background="SteelBlue"
                                    HorizontalOptions="Start"
                                    HorizontalTextAlignment="Start"
                                    Text="Password"
                                    TextColor="Black"
                                    VerticalTextAlignment="Center"
                                    WidthRequest="95" />
                                    <Entry
                                    Grid.Row="2"
                                    Grid.Column="1"
                                    IsPassword="True"
                                    Placeholder="password"
                                    Text="{Binding EditingNetwork.Password}" />
                                </Grid>
                            </ScrollView>
                            <Grid
                            Grid.Row="1"
                            ColumnDefinitions="Auto,Auto"
                            ColumnSpacing="12"
                            HorizontalOptions="End">

                                <!--  Command="{Binding Source={x:Reference RootPopup}, Path=CancelEditCommand}"  -->
                                <!--<Button
                                x:Name="BtnEditorCancel"
                                Grid.Column="0"
                                Clicked="OnInnerCancel"
                                Text="Cancel" />-->
                                <Button
                                Grid.Column="0"
                                Padding="12,4"
                                BackgroundColor="#3B0CA3"
                                Clicked="OnInnerCancel"
                                CornerRadius="18"
                                Text="Cancel"
                                TextColor="White" />

                                <!--<Button
                                x:Name="BtnEditorSave"
                                Grid.Column="1"
                                BackgroundColor="{AppThemeBinding Light=#6366f1,
                                                                  Dark=#4f46e5}"
                                Command="{Binding SaveNetworkCommand}"
                                Text="Add"
                                TextColor="White" />-->
                                <Button
                                Grid.Column="2"
                                Padding="12,4"
                                BackgroundColor="#3B0CA3"
                                Command="{Binding SaveNetworkCommand}"
                                CornerRadius="18"
                                Text="Add"
                                TextColor="White" />
                            </Grid>
                        </Grid>
                    </Border>
                </Grid>


            </Grid>
            <Grid
            BackgroundColor="#80000000"
            HorizontalOptions="Fill"
            IsVisible="{Binding IsBusy}"
            VerticalOptions="Fill"
            ZIndex="10">

                <ActivityIndicator
                HeightRequest="60"
                HorizontalOptions="Center"
                IsRunning="True"
                VerticalOptions="Center"
                WidthRequest="60"
                Color="White" />
            </Grid>
        </Grid>

    </Border>


</toolkit:Popup>

